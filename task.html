<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta HTTP-EQUIV="Expires" Content="-1">
<script src="TurnPts_NP.js"></script>
<!-- script src="latlon2ij.js"></script -->
<!-- script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.5&sensor=false"></script -->
<!-- script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=geometry&sensor=false"></script -->

<SCRIPT type=text/javascript>

/** Aug 27 2008 Fix Thermal Sink Parameter 
	* Caused much nonsense, e.g. -ve GndSpd!
	*/

function writeit(text,id)
{
	if (document.getElementById) {
		x = document.getElementById(id);
		x.innerHTML = '';
		x.innerHTML = text;
	}
	else if (document.all) {
		x = document.all[id];
		x.innerHTML = text;
	}
	else if (document.layers) {
		x = document.layers[id];
		text2 = '<P CLASS="testclass">' + text + '</P>';
		x.document.open();
		x.document.write(text2);
		x.document.close();
	}
}

var uurl;

// add indexOf function 

if (!Array.prototype.indexOf) {
	Array.prototype.indexOf = function(val, fromIndex) {
		if (typeof(fromIndex) != 'number')
			fromIndex = 0;
		for (var index = fromIndex,len = this.length; index < len; index++)
			if (this[index] == val) return index;
		return -1;
	}
}


var radian = 180/Math.PI;
var a = 6378.14;
var f = 1/298.257;
var e = 0.08181922;
var angsgn = " ";


// reduce the degrees,minutes,seconds to radians
function  combine(angsgn,angd,angm,angs) {
	angsgn = angsgn.toUpperCase() 
	if (angsgn == "N" || angsgn == "E") {s = 1};
	if (angsgn == "S" || angsgn == "W") {s = -1};
	angle =s*((angd)+(angm)/60 + (angs)/3600)/radian;
	return angle;
}

// calculate the distance between two coordinates
function calcDistance(lat1,long1,lat2,long2) {
	F = (lat1+lat2)/2;
	G = (lat1-lat2)/2;
	lambda = (long1-long2)/2;
	with(Math) {
		S = pow(sin(G)*cos(lambda),2)+pow(cos(F)*sin(lambda),2);
		C = pow(cos(G)*cos(lambda),2)+pow(sin(F)*sin(lambda),2);
		omega = atan(sqrt(S/C));
		R = sqrt(S*C)/omega;
		D = 2*omega*a;
		H1 =(3*R-1)/2/C;
		H2 =(3*R+1)/2/S;
		s = D*(1+f*H1*pow(sin(F)*cos(G),2)-f*H2*pow(cos(F)*sin(G),2));
	}
	return s;
}

function resetTask()
{
	document.forms['tper'].tp1.value=""; 
	calcAll();
}

// Calculate the three distances
function calcAll()
{
	writeit("",'tpzz');

	var t1v=document.forms['tper'].tp1.value.toUpperCase();
	var t2v=document.forms['tper'].tp2.value.toUpperCase();
	var t3v=document.forms['tper'].tp3.value.toUpperCase();
	var t4v=document.forms['tper'].tp4.value.toUpperCase();
	var t5v=document.forms['tper'].tp5.value.toUpperCase();
	var t6v=document.forms['tper'].tp6.value.toUpperCase();

	if(t1v.length  == 0){	// Clear Task if no TP1
		window.opener.TParray.length = 0;
		window.opener.addTask();
		window.close();
		return;
	}

	if (t1v.length!=3 || t2v=="" || t2v.length!=3 || t1v==t2v) {
		alert("Trigraph input error!"); // Must have at least 2 valid TPs
		return;
	}

	var nTPs=2;

	switch (true){
	case ((t3v!="" && t3v.length!=3) || (t4v!="" && t4v.length!=3) || (t5v!="" && t5v.length!=3)|| (t6v!="" && t6v.length!=3)):
		alert("Trigraph length error!");
		return;
	case ((t1v==t2v) || (t3v!="" && t2v==t3v) || (t4v!="" && t3v==t4v) || (t5v!="" && t4v==t5v) || (t6v!="" && t5v==t6v)):
		alert("Trigraph duplicate error!");
		return;
	case ( (t4v!="" && (t3v=="" )) || (t5v!="" && (t4v==""  ||t3v=="" )) || (t6v!="" && (t5v==""  ||t4v==""  || t3v==""  ))):
		alert("Trigraph input error!");
		return;
	case (t3v!="" && t4v!="" && t5v!="" && t6v!=""):
		nTPs=6;
		break;
	case (t3v!="" && t4v!="" && t5v!=""):
		nTPs=5;
		break;
	case (t3v!="" && t4v!=""):
		nTPs=4;
		break;
	case (t3v!="" && t4v==""):
		nTPs=3;
		break;
	default:
		//alert("Trigraph check error!");
	} 

	//check for valid tp
	switch (true){
		case ((t1v!="") && (tpn.indexOf(t1v)==-1)):
			alert("TP1 not found");
			return;
		case ((t2v!="") && (tpn.indexOf(t2v)==-1)):
			alert("TP2 not found");
			return;
		case ((t3v!="") && (tpn.indexOf(t3v)==-1)):
			alert("TP3 not found");
			return;
		case ((t4v!="") && (tpn.indexOf(t4v)==-1)):
			alert("TP4 not found");
			return;
		case ((t5v!="") && (tpn.indexOf(t5v)==-1)):
			alert("TP5 not found");
			return;
		case ((t6v!="") && (tpn.indexOf(t6v)==-1)):
			alert("TP6 not found");
			return;
		default:
	}

	var TParr = new Array();
	TParr[0] = t1v;
	TParr[1] = t2v;
	if(t3v != "") TParr[2] = t3v;
	if(t4v != "") TParr[3] = t4v;
	if(t5v != "") TParr[4] = t5v;
	if(t6v != "") TParr[5] = t6v;

	var a1= latlo[tpn.indexOf(t1v)];  //get the corresponding latlo from the TP
	var a2= latlo[tpn.indexOf(t2v)];
	var a3= (t3v!="")? latlo[tpn.indexOf(t3v)]: 0;
	var a4= (t4v!="")? latlo[tpn.indexOf(t4v)]: 0;
	var a5= (t5v!="")? latlo[tpn.indexOf(t5v)]: 0;
	var a6= (t6v!="")? latlo[tpn.indexOf(t6v)]: 0;
				 
	var tpd1= tpdesc[tpn.indexOf(t1v)];  //get the corresponding TP description
	var tpd2= tpdesc[tpn.indexOf(t2v)];
	var tpd3= (t3v!="")? tpdesc[tpn.indexOf(t3v)] :0;
	var tpd4= (t4v!="")? tpdesc[tpn.indexOf(t4v)] :0;
	var tpd5= (t5v!="")? tpdesc[tpn.indexOf(t5v)] :0;
	var tpd6= (t6v!="")? tpdesc[tpn.indexOf(t6v)] :0;

	var vt1=a1.indexOf(",");
	var vt2=a2.indexOf(",");

	var vt3=(t3v!="")? a3.indexOf(",") :0;
	var vt4=(t4v!="")? a4.indexOf(",") :0;
	var vt5=(t5v!="")? a5.indexOf(",") :0;
	var vt6=(t6v!="")? a6.indexOf(",") :0;

	var lat1=a1.substring(0,vt1-1);
	var lon1=a1.substring(vt1+1);

	var lat2=a2.substring(0,vt2-1);
	var lon2=a2.substring(vt2+1);

	var lat3=(t3v!="")? a3.substring(0,vt3-1) :0;
	var lon3=(t3v!="")? a3.substring(vt3+1) :0;

	var lat4=(t4v!="")? a4.substring(0,vt4-1) :0;
	var lon4=(t4v!="")? a4.substring(vt4+1) :0;

	var lat5=(t5v!="")? a5.substring(0,vt5-1) :0;
	var lon5=(t5v!="")? a5.substring(vt5+1) :0;

	var lat6=(t6v!="")? a6.substring(0,vt6-1) :0;
	var lon6=(t6v!="")? a6.substring(vt6+1) :0;

	var s12,s23,s34,s45;


	var lt1=(lat1/radian);
	var lt2=(lat2/radian);
	var lt3=(t3v!="")? (lat3/radian) :0;
	var lt4=(t4v!="")? (lat4/radian) :0;
	var lt5=(t5v!="")? (lat5/radian) :0;
	var lt6=(t6v!="")? (lat6/radian) :0;



	var lg1=(lon1/radian);
	var lg2=(lon2/radian);
	var lg3=(t3v!="")? (lon3/radian) :0;
	var lg4=(t4v!="")? (lon4/radian) :0;
	var lg5=(t5v!="")? (lon5/radian) :0;
	var lg6=(t6v!="")? (lon6/radian) :0;

	//alert("lt1= " + lt1+ "\n"+"lt2= "+lt2 + "\n"+"lt3= " + lt3+ "\n"+"lg1= " + lg1+ "\n"+"lg2= "+lg2 + "\n"+"lg3= " + lg3);



	// calculate the distances and put them in the proper text boxes
	// google.maps.geometry.spherical.computeLength(Array[LatLng])

	var sd= calcDistance(lt1,lg1,lt2,lg2);

	var tprs;

	switch (nTPs) {
	case 2:
		latlons=a1+','+a2;
		tprs=tpd1+' - '+tpd2;
		break;
	case 3:
		s23 = calcDistance(lt2,lg2,lt3,lg3);
		sd=sd+s23;
		latlons=a1+','+a2+','+a3;
		tprs=tpd1+' - '+tpd2+' - '+tpd3;
		break;
	case 4:
		 s23= calcDistance(lt2,lg2,lt3,lg3);
		 s34= calcDistance(lt3,lg3,lt4,lg4);
		 sd=sd+s23+s34;
		 latlons=a1+','+a2+','+a3+','+a4;
		 tprs=tpd1+' - '+tpd2+' - '+tpd3+' - '+tpd4;
		 break;
	case 5:
		s23= calcDistance(lt2,lg2,lt3,lg3);
		s34= calcDistance(lt3,lg3,lt4,lg4);
		s45=calcDistance(lt4,lg4,lt5,lg5);
		sd=sd+s23+s34+s45;
		latlons=a1+','+a2+','+a3+','+a4+','+a5;
		tprs=tpd1+' - '+tpd2+' - '+tpd3+' - '+tpd4+' - '+tpd5;
		break;
	case 6:
		s23= calcDistance(lt2,lg2,lt3,lg3);
		s34= calcDistance(lt3,lg3,lt4,lg4);
		s45=calcDistance(lt4,lg4,lt5,lg5);
		s56=calcDistance(lt5,lg5,lt6,lg6);
		sd=sd+s23+s34+s45+s56;
		latlons=a1+','+a2+','+a3+','+a4+','+a5+','+a6;
		tprs=tpd1+' - '+tpd2+' - '+tpd3+' - '+tpd4+' - '+tpd5+' - '+tpd6;
		break;
	default:
		alert("Distance calc error!");
	}


	var taskcoords = window.opener.taskCoords;
	// var taskcoords = [];

	var tpxx = tprs + ' d = ' + sd.toFixed(1) + ' km';
	writeit(tpxx,'tpzz');

	if(confirm(tprs + '\n' + "D = " + sd.toFixed(1) + " km")){
		window.opener.TParray.length = 0;
		for(i = 0; i < TParr.length; i++){
			window.opener.TParray.push(TParr[i]);
		}
		window.opener.addTask();
		window.close();
	}
}

function setTP1(what) // put TP name into highlighted TP box 
{
	var wog=document.forms['tper'].seltp.value;

	if (wog=='0') {
		document.forms['tper'].seltp.focus();
		return;
	}
	document.forms['tper'].tps.options.selectedIndex=0;

	//alert(wog);
	switch (wog) {
	case 'TP1': document.forms['tper'].tp1.value=what; break;
	case 'TP2': document.forms['tper'].tp2.value=what; break;
	case 'TP3': document.forms['tper'].tp3.value=what; break;
	case 'TP4': document.forms['tper'].tp4.value=what; break;
	case 'TP5': document.forms['tper'].tp5.value=what; break;
	case 'TP6': document.forms['tper'].tp6.value=what; break;
	default:                                           break;
	}
}

function setTP2(what)  // put name from tp selector in tp box
{
	document.forms['tper'].focus();
	var doba=document.forms['tper'].tps.options.selectedIndex;

	var dob=document.forms['tper'].tps.options[doba].text;

	if (dob=='-') {
		document.forms['tper'].tps.focus();
		return;
	}
	switch (what) {
	case 'TP1': document.forms['tper'].tp1.value=dob; break;
	case 'TP2': document.forms['tper'].tp2.value=dob; break;
	case 'TP3': document.forms['tper'].tp3.value=dob; break;
	case 'TP4': document.forms['tper'].tp4.value=dob; break;
	case 'TP5': document.forms['tper'].tp5.value=dob; break;
	default:                                          break;
	}
}

function init()  //make sure browser supports populating select boxes
{
	var box1 = document.forms['tper'].tps;

	box1.options.length = 0;

	for(i=0;i<latlo.length;i++){  //fill trigraph box with txt tpn & latlo values 
		box1.options[i] = new Option(tpdesc[i],latlo[i]);
	} 

	if(window.opener.TParray[0] != null){
		document.forms['tper'].tp1.value = window.opener.TParray[0];
	}
	if(window.opener.TParray[1] != null){
		document.forms['tper'].tp2.value = window.opener.TParray[1];
	}
	if(window.opener.TParray[2] != null){
		document.forms['tper'].tp3.value = window.opener.TParray[2];
	}
	if(window.opener.TParray[3] != null){
		document.forms['tper'].tp4.value = window.opener.TParray[3];
	}
	if(window.opener.TParray[4] != null){
		document.forms['tper'].tp5.value = window.opener.TParray[4];
	}
	if(window.opener.TParray[5] != null){
		document.forms['tper'].tp6.value = window.opener.TParray[5];
	}
}


</SCRIPT>

<TITLE>UK RASP Specify Task</TITLE>
</HEAD>
<BODY onload=init();>
	<DIV align=center>
		<B><FONT size=+2>Specify Task</FONT></B>
		<br>
		<table border=0>
			<tr colspan=6>
				<td>
					Select data from drop down boxes.
					<br>
					TPs can be entered manually
					<br>
					Press 'DONE' when finished
				</td>
			</tr>
		</table>
	</DIV>
	<BR>

<FORM id=1 name=tper>
	<TABLE align=center cellSpacing=0 cellPadding=0 width="20%" bgColor=#ff8800 border=1>
		<TBODY>
			<TR>
				<TD vAlign=top align=left width="6%">Select TP #:     </TD>
				<TD vAlign=top align=left width="6%">Select Trigraph: </TD>
				<TD vAlign=bottom align=middle width="4%">TP1:        </TD>
				<TD vAlign=bottom align=middle width="4%">TP2:        </TD>
				<TD vAlign=bottom align=middle width="4%">TP3:        </TD>
				<TD vAlign=bottom align=middle width="4%">TP4:        </TD>
				<TD vAlign=bottom align=middle width="4%">TP5:        </TD>
				<TD vAlign=bottom align=middle width="4%">TP6:        </TD>
				<TD vAlign=center align=middle>
					<button onclick="resetTask();">Clear</button>
				</TD>
			</TR>
			<TR>
				<TD>
					<SELECT onchange=setTP2(this.options[this.selectedIndex].text) name=seltp> 
					<OPTION value=0 selected>-</OPTION>
					<OPTION value=TP1>TP1</OPTION> 
					<OPTION value=TP2>TP2</OPTION>
					<OPTION value=TP3>TP3</OPTION>
					<OPTION value=TP4>TP4</OPTION>
					<OPTION value=TP5>TP5</OPTION>
					<OPTION value=TP6>TP6</OPTION>
					</SELECT> 
				</TD>
				<TD vAlign=center align=middle width="4%">
					<SELECT onchange=setTP1(tpn[this.selectedIndex]) name=tps>
					<OPTION value=0 selected>TP LOAD</OPTION>
					</SELECT>
				</TD>
				<TD vAlign=center align=middle>
					<INPUT style="TEXT-TRANSFORM: uppercase" maxLength=3 size=3 name=tp1> 
				</TD>
				<TD vAlign=center align=middle>
					<INPUT style="TEXT-TRANSFORM: uppercase" maxLength=3 size=3 name=tp2> 
				</TD>
				<TD vAlign=center align=middle>
					<INPUT style="TEXT-TRANSFORM: uppercase" maxLength=3 size=3 name=tp3> 
				</TD>
				<TD vAlign=center align=middle>
					<INPUT style="TEXT-TRANSFORM: uppercase" maxLength=3 size=3 name=tp4>
				</TD>
				<TD vAlign=center align=middle>
					<INPUT style="TEXT-TRANSFORM: uppercase" maxLength=3 size=3 name=tp5>
				</TD>
				<TD vAlign=center align=middle>
					<INPUT style="TEXT-TRANSFORM: uppercase" maxLength=3 size=3 name=tp6>
				</TD>
				<TD vAlign=center align=middle>
					<!-- INPUT style="TEXT-TRANSFORM: uppercase" onclick=calcAll(); type=button size=8 value=Done name=go -->
					<button onclick="calcAll();">DONE</button>
				</TD>
			</TR>
		</TBODY>
	</TABLE>

		<br>
		<DIV class=testclass id=tpzz> </DIV>
		<DIV class=testclass id=urll> </DIV>
		<DIV id=stuff> </DIV>
		<br>
</FORM>
</BODY>
</HTML>
